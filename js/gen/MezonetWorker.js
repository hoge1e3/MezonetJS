var requirejs,require,define;!function(e){function n(e,n){return w.call(e,n)}function t(e,n){var t,r,o,i,a,s,u,f,c,l,d,m,p=n&&n.split("/"),Z=h.map,v=Z&&Z["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,h.nodeIdCompat&&y.test(e[a])&&(e[a]=e[a].replace(y,"")),"."===e[0].charAt(0)&&p&&(m=p.slice(0,p.length-1),e=m.concat(e)),c=0;c<e.length;c++)if("."===(d=e[c]))e.splice(c,1),c-=1;else if(".."===d){if(0===c||1===c&&".."===e[2]||".."===e[c-1])continue;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((p||v)&&Z){for(t=e.split("/"),c=t.length;c>0;c-=1){if(r=t.slice(0,c).join("/"),p)for(l=p.length;l>0;l-=1)if((o=Z[p.slice(0,l).join("/")])&&(o=o[r])){i=o,s=c;break}if(i)break;!u&&v&&v[r]&&(u=v[r],f=c)}!i&&u&&(i=u,s=f),i&&(t.splice(0,s,i),e=t.join("/"))}return e}function r(n,t){return function(){var r=g.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),l.apply(e,r.concat([n,t]))}}function o(e){return function(n){return t(n,e)}}function i(e){return function(n){p[e]=n}}function a(t){if(n(Z,t)){var r=Z[t];delete Z[t],v[t]=!0,c.apply(e,r)}if(!n(p,t)&&!n(v,t))throw new Error("No "+t);return p[t]}function s(e){var n,t=e?e.indexOf("!"):-1;return t>-1&&(n=e.substring(0,t),e=e.substring(t+1,e.length)),[n,e]}function u(e){return e?s(e):[]}function f(e){return function(){return h&&h.config&&h.config[e]||{}}}var c,l,d,m,p={},Z={},h={},v={},w=Object.prototype.hasOwnProperty,g=[].slice,y=/\.js$/;d=function(e,n){var r,i=s(e),u=i[0],f=n[1];return e=i[1],u&&(u=t(u,f),r=a(u)),u?e=r&&r.normalize?r.normalize(e,o(f)):t(e,f):(e=t(e,f),i=s(e),u=i[0],e=i[1],u&&(r=a(u))),{f:u?u+"!"+e:e,n:e,pr:u,p:r}},m={require:function(e){return r(e)},exports:function(e){var n=p[e];return void 0!==n?n:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:f(e)}}},c=function(t,o,s,f){var c,l,h,w,g,y,S,M=[],C=typeof s;if(f=f||t,y=u(f),"undefined"===C||"function"===C){for(o=!o.length&&s.length?["require","exports","module"]:o,g=0;g<o.length;g+=1)if(w=d(o[g],y),"require"===(l=w.f))M[g]=m.require(t);else if("exports"===l)M[g]=m.exports(t),S=!0;else if("module"===l)c=M[g]=m.module(t);else if(n(p,l)||n(Z,l)||n(v,l))M[g]=a(l);else{if(!w.p)throw new Error(t+" missing "+l);w.p.load(w.n,r(f,!0),i(l),{}),M[g]=p[l]}h=s?s.apply(p[t],M):void 0,t&&(c&&c.exports!==e&&c.exports!==p[t]?p[t]=c.exports:h===e&&S||(p[t]=h))}else t&&(p[t]=s)},requirejs=require=l=function(n,t,r,o,i){if("string"==typeof n)return m[n]?m[n](t):a(d(n,u(t)).f);if(!n.splice){if(h=n,h.deps&&l(h.deps,h.callback),!t)return;t.splice?(n=t,t=r,r=null):n=e}return t=t||function(){},"function"==typeof r&&(r=o,o=i),o?c(e,n,t,r):setTimeout(function(){c(e,n,t,r)},4),l},l.config=function(e){return l(e)},requirejs._defined=p,define=function(e,t,r){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(r=t,t=[]),n(p,e)||n(Z,e)||(Z[e]=[e,t,r])},define.amd={jQuery:!0}}(),define("almond",function(){}),define("assert",[],function(){function e(n){if(n instanceof Array){var t=[];return n.forEach(function(n){t=t.concat(e(n))}),t}return[n]}var n,t=function(n){this.failMesg=e(n||"Assertion failed: ")};t.prototype={_regedType:{},registerType:function(e,n){this._regedType[e]=n},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var t=n(arguments),r=t.shift();if(t=e(t),t=this.failMesg.concat(r).concat(t),console.log.apply(console,t),this.isDefensive())return r;if(this.isBool())return!1;throw new Error(t.join(" "))},subAssertion:function(){var r=n(arguments);return r=e(r),new t(this.failMesg.concat(r))},assert:function(e,n){return e||this.fail(e,n)},eq:function(e,n){return e!==n?this.fail(e,"!==",n):!!this.isBool()||e},ne:function(e,n){return e===n?this.fail(e,"===",n):!!this.isBool()||e},isset:function(e,n){return null==e?this.fail(e,(n||"")+" is null/undef"):!!this.isBool()||e},is:function(e,n){var t=n,r=e;if(null==t)return this.fail(e,"assert.is: type must be set");if(t._assert_func)return t._assert_func.apply(this,[r]),!!this.isBool()||e;if(this.assert(null!=e,[e,"should be ",t]),t instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&t instanceof global.Array){if(!e||"number"!=typeof e.length)return this.fail(e,"should be array:");for(var o=this,i=0;i<t.length;i++){var a=o.subAssertion("failed at ",e,"[",i,"]: ");null==t[i]&&console.log("WOW!7",r[i],t[i]),a.is(r[i],t[i])}return!!this.isBool()||e}if(t===String||"string"==t)return this.assert("string"==typeof r,[r,"should be a string "]),!!this.isBool()||e;if(t===Number||"number"==t)return this.assert("number"==typeof r,[r,"should be a number"]),!!this.isBool()||e;if(t===Boolean||"boolean"==t)return this.assert("boolean"==typeof r,[r,"should be a boolean"]),!!this.isBool()||e;if(t instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&t instanceof global.RegExp)return this.is(r,String),this.assert(t.exec(r),[r,"does not match to",t]),!!this.isBool()||e;if(t===Function)return this.assert("function"==typeof r,[r,"should be a function"]),!!this.isBool()||e;if("function"==typeof t)return this.assert(r instanceof t,[r,"should be ",t]),!!this.isBool()||e;if(t&&"object"==typeof t){for(var s in t){var a=this.subAssertion("failed at ",e,".",s,":");a.is(e[s],t[s])}return!!this.isBool()||e}if("string"==typeof t){var u=this._regedType[t];return u?this.is(e,u):!!this.isBool()||e}return this.fail(e,"Invaild type: ",t)},ensureError:function(e,n){try{e()}catch(t){return"string"==typeof n&&o(t+""===n,e+" thrown an error "+t+" but expected:"+n),void console.log("Error thrown successfully: ",t.message)}this.fail(e,"should throw an error",n)},setMode:function(e){this._mode=e},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},n=function(e){for(var n=[],t=0;t<e.length;t++)n.push(e[t]);return n};var r=new t,o=function(){try{return r.assert.apply(r,arguments)}catch(e){throw new Error(e.stack)}};return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(e){o[e]=function(){try{return r[e].apply(r,arguments)}catch(e){throw console.log(e.stack),new Error(e.message)}}}),o.fail=r.fail.bind(r),o.MODE_STRICT=r.MODE_STRICT,o.MODE_DEFENSIVE=r.MODE_DEFENSIVE,o.MODE_BOOL=r.MODE_BOOL,o.f=function(e){return{_assert_func:e}},o.opt=function(e){return o.f(function(n){return null==n||n instanceof e})},o.and=function(){var e=n(arguments);return o(e instanceof Array),o.f(function(n){for(var t=this,r=0;r<e.length;r++)t.is(n,e[r])})},o}),define("Klass",["assert"],function(e){function n(e){var n=/function[^\(]*\(([^\)]*)\)/,t=n.exec(e+"");return t?t[1].replace(/\s/g,"").split(","):[]}function t(e){if("object"!=typeof e)return!1;if(!e)return!1;var n={configurable:1,enumerable:1,value:1,writable:1,get:1,set:1},t=0;for(var r in e){if(!n[r])return!1;t+=n[r]}return t}var r={};return r.define=function(o){function i(n){o.$fields&&e.is(n,o.$fields)}function a(e,r){if(!f)return e;if(t(e)){for(var o in e)e[o]=a(e[o]);return e}if("function"!=typeof e)return e;if(!0!==f){if(n(e)[0]!==f)return p=p||[],p.push(r),e;d=!0}return m=!0,function(){var n=Array.prototype.slice.call(arguments);return n.unshift(this),e.apply(this,n)}}var s,u;o.$parent?(u=o.$parent,s=Object.create(u.prototype),s.super=function(){var e=Array.prototype.slice.call(arguments),n=e.shift();return u.prototype[n].apply(this,e)}):s={};var f,c;o.$this&&(f=o.$this),o.$singleton&&(c=o.$singleton);var l,d,m,p,Z=a(o.$)||function(e){if(e&&"object"==typeof e)for(var n in e)this[n]=e[n]};Z instanceof Array&&(l=Z,Z=function(){for(var e=Array.prototype.slice.call(arguments),n=0;n<l.length;n++)e.length>0&&(this[l[n]]=e.shift())});var h;h=function(){if(!(this instanceof h)){var e=Object.create(s);return Z.apply(e,arguments),i(e),e}Z.apply(this,arguments),i(this)},u&&(h.super=function(){var e=Array.prototype.slice.call(arguments),n=e.shift(),t=e.shift();return u.prototype[t].apply(n,e)}),h.inherit=function(e){return e.$parent=h,r.define(e)},h.prototype=s;for(var v in o)"$"!=v[0]&&("static$"==v.substring(0,7)?h[v.substring(7)]=function(e){return c?n(e)[0]!==c?e:function(){var n=Array.prototype.slice.call(arguments);return n.unshift(h),e.apply(h,n)}:e}(o[v]):t(o[v])?Object.defineProperty(s,v,a(o[v],v)):s[v]=a(o[v],v));if(s.$=Z,Object.defineProperty(s,"$bind",{get:function(){return this.__bounded||(this.__bounded=new r.Binder(this)),this.__bounded}}),d){p?console.warn("Use python style in all methods and Use $this:true instead",p):console.warn("Use $this:true instead");try{throw new Error("Stakku")}catch(e){console.log(e.stack)}}return h},r.Function=function(){throw new Error("Abstract")},r.opt=e.opt,r.Binder=r.define({$this:!0,$:function(e,n){for(var t in n)!function(t){"function"==typeof n[t]&&(e[t]=function(){var e=Array.prototype.slice.call(arguments);return n[t].apply(n,e)})}(t)}}),r}),function e(n,t,r){function o(a,s){if(!t[a]){if(!n[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var c=t[a]={exports:{}};n[a][0].call(c.exports,function(e){var t=n[a][1][e];return o(t||e)},c,c.exports,e,n,t,r)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,n,t){function r(){}var o=n.exports={};o.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(n){var t=[];return window.addEventListener("message",function(e){var n=e.source;if((n===window||null===n)&&"process-tick"===e.data&&(e.stopPropagation(),t.length>0)){t.shift()()}},!0),function(e){t.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=r,o.addListener=r,o.once=r,o.off=r,o.removeListener=r,o.removeAllListeners=r,o.emit=r,o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],2:[function(e,n,t){"use strict";function r(e){function n(e){if(null===u)return void c.push(e);a(function(){var n=u?e.onFulfilled:e.onRejected;if(null===n)return void(u?e.resolve:e.reject)(f);var t;try{t=n(f)}catch(n){return void e.reject(n)}e.resolve(t)})}function t(e){try{if(e===l)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void i(n.bind(e),t,r)}u=!0,f=e,s()}catch(e){r(e)}}function r(e){u=!1,f=e,s()}function s(){for(var e=0,t=c.length;e<t;e++)n(c[e]);c=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");var u=null,f=null,c=[],l=this;this.then=function(e,t){return new l.constructor(function(r,i){n(new o(e,t,r,i))})},i(e,t,r)}function o(e,n,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.resolve=t,this.reject=r}function i(e,n,t){var r=!1;try{e(function(e){r||(r=!0,n(e))},function(e){r||(r=!0,t(e))})}catch(e){if(r)return;r=!0,t(e)}}var a=e("asap");n.exports=r},{asap:4}],3:[function(e,n,t){"use strict";function r(e){this.then=function(n){return"function"!=typeof n?this:new o(function(t,r){i(function(){try{t(n(e))}catch(e){r(e)}})})}}var o=e("./core.js"),i=e("asap");n.exports=o,r.prototype=o.prototype;var a=new r(!0),s=new r(!1),u=new r(null),f=new r(void 0),c=new r(0),l=new r("");o.resolve=function(e){if(e instanceof o)return e;if(null===e)return u;if(void 0===e)return f;if(!0===e)return a;if(!1===e)return s;if(0===e)return c;if(""===e)return l;if("object"==typeof e||"function"==typeof e)try{var n=e.then;if("function"==typeof n)return new o(n.bind(e))}catch(e){return new o(function(n,t){t(e)})}return new r(e)},o.all=function(e){var n=Array.prototype.slice.call(e);return new o(function(e,t){function r(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){r(i,e)},t)}n[i]=a,0==--o&&e(n)}catch(e){t(e)}}if(0===n.length)return e([]);for(var o=n.length,i=0;i<n.length;i++)r(i,n[i])})},o.reject=function(e){return new o(function(n,t){t(e)})},o.race=function(e){return new o(function(n,t){e.forEach(function(e){o.resolve(e).then(n,t)})})},o.prototype.catch=function(e){return this.then(null,e)}},{"./core.js":2,asap:4}],4:[function(e,n,t){(function(e){function t(){for(;o.next;){o=o.next;var e=o.task;o.task=void 0;var n=o.domain;n&&(o.domain=void 0,n.enter());try{e()}catch(e){if(u)throw n&&n.exit(),setTimeout(t,0),n&&n.enter(),e;setTimeout(function(){throw e},0)}n&&n.exit()}a=!1}function r(n){i=i.next={task:n,domain:u&&e.domain,next:null},a||(a=!0,s())}var o={task:void 0,next:null},i=o,a=!1,s=void 0,u=!1;if(void 0!==e&&e.nextTick)u=!0,s=function(){e.nextTick(t)};else if("function"==typeof setImmediate)s="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var f=new MessageChannel;f.port1.onmessage=t,s=function(){f.port2.postMessage(0)}}else s=function(){setTimeout(t,0)};n.exports=r}).call(this,e("_process"))},{_process:1}],5:[function(e,n,t){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(e,n){(arguments.length?this.then.apply(this,arguments):this).then(null,function(e){setTimeout(function(){throw e},0)})})},{}],6:[function(e,n,t){e("asap");"undefined"==typeof Promise&&(Promise=e("./lib/core.js"),e("./lib/es6-extensions.js")),e("./polyfill-done.js")},{"./lib/core.js":2,"./lib/es6-extensions.js":3,"./polyfill-done.js":5,asap:4}]},{},[6]),define("promise",function(){}),define("SEnv",["Klass","assert","promise"],function(e,n,t){function r(){return(new Date).getTime()}function o(e){return e/128-1}var i=function(e,n){return Math.trunc(e/n)},a=function(e,n){if(e!==e)throw new Error(n+": Not a number!");if("number"!=typeof e)throw console.error(e),new Error(n+": Not a not a number but not a number!");return e},s=(Math.abs.bind(Math),function(e){return e>=128?e-256:e}),u=function(e,n){for(var t=[],r=n;e[r];r++)t.push(e[r]);return t},f=function(e,n){var t=e[n];return t+=256*e[n+1],t+=65536*e[n+2],t+=16777216*e[n+3],t>=2147483648&&(t-=4294967296),t},c=Number,l=[3421,3228,3047,2876,2715,2562,2419,2283,2155,2034,1920,1812,1711,1614,1524,1438,1358,1281,1210,1142,1078,1017,960,906,855,807,762,719,679,641,605,571,539,509,480,453,428,404,381,360,339,320,302,285,269,254,240,227,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95,90,85,80,76,71,67,64,60,57,53,50,48,45,42,40,38,36,34,32,30,28,27,25,24,22,21,20,19,18,17,16,15,14],d=(Math.trunc.bind(),[]),m=[],p=0;return e.define({$this:!0,$fields:{Pos:c,PrevPos:c,RPos:c,WaveDat:Array,wdata2:Array,BeginPlay:Boolean,SeqTime:c,SeqTime120:c,wavoutContext:Boolean,Fading:c,PCMW:Array,Delay:c,Tempo:c,ComStr:String,WFilename:String,EnvDat:Array,WriteMaxLen:c},load:function(e,n){function t(e){if(0==e.length)throw new Error("Out of data");return e.shift()}function r(e){if(e.length<4)throw new Error("Out of data");var n=e.shift(),t=1;return t<<=8,n+=e.shift()*t,t<<=8,n+=e.shift()*t,t<<=8,n+=e.shift()*t}for(var o=(r(n),t(n)),i=0;i<o;i++){for(var a=[],s=r(n),u=0;u<s;u++)a.push(t(n));e.channels[i].MPoint=a}},setNoiseWDT:function(e){for(var n=0;n<1024;n++)e.WaveDat[95][n]=o(Math.floor(78*Math.random()+90))},loadWDT:function(e,n){return new Promise(function(t,r){try{n||requirejs(["Tones.wdt"],function(n){e.loadWDT(n).then(t,r)});var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer",i.onload=function(n){var r,a,s=i.response;if(s){var u=new Uint8Array(s),f=0;for(r=0;r<96;r++)for(a=0;a<32;a++)e.WaveDat[r][a]=o(u[f++]);for(e.setNoiseWDT(),r=0;r<16;r++)for(a=0;a<32;a++)e.EnvDat[r][a]=u[f++];t()}},i.send(null)}catch(e){r(e)}})},setSound:function(e,n,t,r){var o=e.channels[n];switch(o.soundMode=!0,t){case 1:o.Steps=r;break;case 2:o.EVol=r}},InitSin:function(e){var n;for(n=0;n<2048;n++)m[n]=Math.trunc(127*Math.sin(6.2831852*n/2048))},InitEnv:function(e){var n,t;for(e.EnvDat=[],n=0;n<16;n++)for(e.EnvDat[n]=[],t=0;t<32;t++)e.EnvDat[n][t]=Math.floor((31-t)/2)},ConvM2T:function(e){var n;for(d=[],n=0;n<96;n++)d[n]=Math.trunc(7330908160/l[n]*65536/e.sampleRate)},InitWave:function(e){var n,t;for(e.WaveDat=[],n=0;n<96;n++)for(e.WaveDat[n]=[],t=0;t<16;t++)e.WaveDat[n][t]=o(103),e.WaveDat[n][t+i(32,2)]=o(153)},$:function(e,n,t){var r;for(t=t||{},e.useScriptProcessor=t.useScriptProcessor,e.useFast=t.useFast,e.resolution=t.resolution||120,e.wavOutSpeed=t.wavOutSpeed||10,e.context=n,e.sampleRate=a(e.context.sampleRate,"t.context.sampleRate"),e.Delay=2e3,e.Pos=e.PrevPos=e.RPos=e.SeqTime=e.SeqTime120=0,e.BeginPlay=!1,e.InitWave(),e.InitEnv(),e.InitSin(),e.ConvM2T(),e.wdata2=[],e.PCMW=[],r=0;r<16;r++)e.PCMW[r]=null;for(e.channels=[],r=0;r<10;r++)e.channels.push({});e.resetChannelStates(),e.Fading=256,e.timeLag=2e3,e.WriteMaxLen=2e4,e.wavoutContext=!1,e.WFilename="",e.ComStr="",e.performance={timeForChProc:0,timeForWrtSmpl:0}},resetChannelStates:function(e){for(var n=0;n<10;n++){var t=e.channels[n];t.LfoV=0,t.LfoA=0,t.LfoC=0,t.LfoD=0,t.LfoDC=0,t.LfoSync=0,t.Slur=t.Sync=0,t.PorStart=t.PorEnd=t.PorLen=0,t.ECount=0,t.MCount=0,t.Resting=0,t.Steps=0,t.SccWave=e.WaveDat[0],t.SccCount=0,t.EShape=e.EnvDat[0],t.EVol=0,t.EBaseVol=128,t.MPointC=0,t.ESpeed=5,t.PlayState="psStop",t.Detune=0,t.LfoV=0,e.SelWav(n,0),t.LfoD=0,t.LfoDC=0,t.Oct=4,t.soundMode=!1}e.Tempo=120,e.rate=1},Play1Sound:function(e,n,t,r){var o=e.channels[n];if(!o.soundMode)return 99==t?void(o.Resting=!0):void(n<0||n>=10||t<0||t>95||(o.Resting=!1,r||(o.ECount=0,o.Sync&&(o.SccCount=0),0!=o.LfoSync&&(o.LfoC=0)),o.CurWav<96?(o.Steps=d[t]+o.Detune*i(d[t],2048),95===o.CurWav&&(o.Steps>>>=5)):o.L2WL>=2&&(o.Steps=i(1073741824>>>o.L2WL-2,i(d[36],65536))*i(d[t],65536)),o.PorLen=-1))},Play1Por:function(e,n,t,r,o){var a=e.channels[n];n<0||n>=10||r<0||r>95||t<0||t>95||(a.Resting=!1,a.PorStart=d[t]+a.Detune*i(d[t],2048),a.PorEnd=d[r]+a.Detune*i(d[r],2048),95===a.CurWav&&(a.PorStart>>>=5,a.PorEnd>>>=5),o||(a.ECount=0))},StopMML:function(e,n){n<0||n>=10||(e.WaitMML(n),e.channels[n].PlayState="psStop",e.channels[n].MCount=e.SeqTime+1)},allWaiting:function(e){for(var n=0;n<10;n++)if("psPlay"==e.channels[n].PlayState)return!1;return!0},handleAllState:function(e){var n,t=!0,r=!0;for(n=0;n<10;n++)switch(e.channels[n].PlayState){case"psPlay":t=!1,r=!1;break;case"psWait":r=!1}if(t&&!r)for(n=0;n<10;n++)e.RestartMML(n);return r},allStopped:function(e){for(var n=0;n<10;n++)if("psStop"!=e.channels[n].PlayState)return!1;return!0},RestartMML:function(e,n){if(!(n<0||n>=10)){var t=e.channels[n];"psWait"==t.PlayState&&(t.PlayState="psPlay",t.MCount=e.SeqTime+1)}},restartIfAllWaiting:function(e){if(e.allWaiting())for(var n=0;n<10;n++)e.RestartMML(n)},WaitMML:function(e,n){if(!(n<0||n>=10)){var t=e.channels[n];t.PlayState="psWait",t.MCount=e.SeqTime+1}},Rewind:function(e){var n;for(e.resetChannelStates(),e.SeqTime=0,e.trackTime=0,n=0;n<10;n++){e.channels[n].PlayState="psPlay"}},resetWavOut:function(e){e.wavoutContext=!1},wavOut:function(e,n){n=n||{};var t=e.resolution,r=[],o=n.maxSamples;e.wavoutContext||(e.Rewind(),e.wavoutContext={label2Time:[],PC2Time:[],writtenSamples:0,loopStartFrac:null});var i=e.wavoutContext;i.arysrc=r,i.maxSamples=o,"number"==typeof n.rate&&(e.rate=n.rate);var a=(e.wavOutSpeed,0);return new Promise(function(n){for(;;){var s=o&&a>=o-t;if(!s){for(var u=0;u<t;u++)r.push(0);e.refreshPSG(r,r.length-t,t),a+=t}if(e.allStopped()||s)return i.hasNext=s,s||(e.wavoutContext=!1),void n(i)}})},SelWav:function(e,n,t){var r=e.channels[n];r.CurWav=t,t<96?(r.SccWave=e.WaveDat[t],r.L2WL=5,95===t&&(r.L2WL=10),r.Sync=!1):null!=e.PCMW[t-96]&&(r.SccWave=e.PCMW[t-96].Start,r.L2WL=e.PCMW[t-96].Log2Len,r.Sync=!0)},RegPCM:function(e,n,t){console.log("[STUB]regpcm",n.map(function(e){return String.fromCharCode(e)}),t)},refreshPSG:function(e,n,t,r){e.procChannels(r),e.writeSamples(n,t,r)},procChannels:function(e,n){var t,i,a,c,l,d;p++;var m=(e.sampleRate,44100/e.sampleRate);(new Date).getTime();if(!e.allStopped()){var Z,h=e.SeqTime,v=r(),w=e.wavoutContext;for(i=0;i<10;i++)if(Z=e.channels[i],null==Z.MPoint[Z.MPointC]&&e.StopMML(i),"psPlay"==Z.PlayState)for(d=0;Z.MCount<=h;){var g=Z.MPointC;w&&!w.maxSamples&&0==i&&(w.PC2Time[g]=w.writtenSamples),c=Z.MPoint[g+1],l=Z.MPoint[g+2];var y=Z.MPoint[g];if(y>=0&&y<96||99===y)e.Play1Sound(i,y,Z.Slur),Z.Slur||(Z.LfoDC=Z.LfoD),Z.Slur=!1,Z.MCount+=2*(c+256*l),Z.MPointC+=3;else switch(y){case 106:e.Play1Por(i,c,l,Z.Slur),Z.Slur=!1,Z.MCount+=2*(Z.MPoint[g+3]+256*Z.MPoint[g+4]),Z.PorLen=Z.MCount-h,Z.MPointC+=5;break;case 103:e.Tempo=c+256*l,Z.MPointC+=3;break;case 100:Z.EVol=c,Z.MPointC+=2;break;case 119:Z.EBaseVol=c,Z.MPointC+=2;break;case 101:Z.ESpeed=c,Z.MPointC+=2;break;case 102:e.SelWav(i,c),Z.MPointC+=2;break;case 113:for(Z.MPointC+=34,t=0;t<32;t++)e.WaveDat[c][t]=o(Z.MPoint[g+2+t]);break;case 107:Z.EShape=e.EnvDat[c],Z.MPointC+=2;break;case 114:for(Z.MPointC+=34,t=0;t<32;t++)a=Z.MPoint[g+2+t],a>15&&(a=15),e.EnvDat[c][t]=a;break;case 104:if(w&&!w.maxSamples){if(0==i){var S=Z.MPointC+f(Z.MPoint,g+1),M=w.PC2Time[S];"number"==typeof M&&M<w.writtenSamples&&(w.loopStartFrac=[M,e.sampleRate],console.log("@jump","ofs=",w.loopStartFrac))}Z.MPointC+=5}else Z.MPointC+=f(Z.MPoint,g+1);d++,d>1&&(console.log("Jumpsafe!"),e.StopMML(i),Z.MCount=h+1);break;case 120:Z.MPointC+=2;break;case 105:Z.Slur=!0,Z.MPointC+=1;break;case 108:e.WaitMML(i),Z.MPointC+=1;break;case 109:e.ComStr=u(Z.MPoint,g+1),Z.MPointC+=e.ComStr.length+2;break;case 111:e.WFilename=u(Z.MPoint,g+1),Z.MPointC+=e.WFilename.length+2;break;case 112:Z.MPointC+=1;break;case 110:Z.Detune=s(c),Z.MPointC+=2;break;case 115:Z.LfoSync=c,Z.LfoV=65536*l,Z.LfoA=Z.MPoint[g+3],Z.LfoD=0,Z.MPointC+=4;break;case 118:Z.LfoD=c*e.sampleRate,Z.MPointC+=2;break;case 116:Z.Sync=1==c,Z.MPointC+=2;break;case 117:var C=u(Z.MPoint,g+1);e.RegPCM(C,Z.MPoint[g+1+C.length+1]),Z.MPointC+=C.length+3;break;case 255:e.StopMML(i);break;default:throw e.StopMML(i),new Error("Invalid opcode"+y)}}e.handleAllState(),e.SeqTime+=Math.floor(e.Tempo*(n/120)*m*e.rate),e.trackTime+=n/e.sampleRate*e.rate,w&&(w.writtenSamples+=n,w.trackTime=e.trackTime),e.performance.timeForChProc+=r()-v}},writeSamples:function(e,n,t,o){var a,s,u,f=0,c=0,l=t+o;for(u=t;u<l;u++)n[u]=0;if(!e.allStopped()){var d=r();for(a=0;a<10;a++)if(s=e.channels[a],"psPlay"==s.PlayState&&(s.PorLen>0&&(c=s.MCount-e.SeqTime,s.Steps=i(s.PorStart,s.PorLen)*c+i(s.PorEnd,s.PorLen*(s.PorLen-c))),f=s.soundMode?s.EVol:s.Resting?0:s.EShape[s.ECount>>>11]*s.EVol*s.EBaseVol,e.Fading<256&&(f*=i(e.Fading,256)),s.ECount+s.ESpeed*(o/2)<65536&&(s.ECount+=s.ESpeed*(o/2)),!((f/=524288)<=0))){var p=s.SccCount,Z=s.Steps,h=s.SccWave,v=32-s.L2WL;for(0!=s.LfoV&&(s.LfoDC>0?s.LfoDC-=e.Tempo*o:(Z+=m[s.LfoC>>>21]*(Z>>9)*s.LfoA>>8,s.LfoC+=s.LfoV/2*o)),u=t;u<l;u++)n[u]+=f*h[p>>>v],p+=Z;s.SccCount=p>>>0}e.setNoiseWDT(),e.performance.timeForWrtSmpl+=r()-d}}})}),define("root",[],function(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:function(){return this}()}),define("WorkerServiceW",["promise","root"],function(e,n){var t=1,r={},o={},i=n;return n.WorkerService={install:function(e,n){r[e]=n},serv:function(e,n){this.install(e,n)},ready:function(){n.WorkerService.isReady=!0,i.postMessage({ready:!0})},reverse:function(e,n){var r=t++;return new Promise(function(t,a){o[r]=function(e){"ok"==e.status?t(e.result):a(e.error)},i.postMessage({reverse:!0,id:r,path:e,params:n})})}},i.addEventListener("message",function(e){function n(e){i.postMessage({id:a,error:e?e.stack||e+"":"unknown",status:"error"})}var t=e.data,a=t.id,s={id:a};if(t.reverse)return o[t.id](t),void delete o[t.id];try{Promise.resolve(r[t.path](t.params,s)).then(function(e){i.postMessage({id:a,result:e,status:"ok"})},n)}catch(e){n(e)}}),n.WorkerService.install("WorkerService/isReady",function(){return n.WorkerService.isReady}),n.console||(n.console={log:function(){n.WorkerService.reverse("console/log",Array.prototype.slice.call(arguments))}}),n.WorkerService}),define("Tones.wdt",[],function(){return"data:application/octet-stream;base64,UFBQUFBQUFBQUFBQUFBQULm5ubm5ubm5ubm5ubm5ublnZ2dnZ6einUdETExBTHyao6OZnpNASWqZmJqZMENshm1LOjA6UFZOMys4RVBfZ3iHmKCvwMfUzLGpr8XPxbSSoGdnVUpBQD9BSUpKTlJjfK7BxL+xoHxiVkpPaIGToK1oYVZORkA5NDQ0NjpBSVZgbHuKlaOrrq6tq6Sfk4d8dopORUtVYGJobGdQRTw7RmF4jLO6uK+cmZmZmZqalY6MTkxOS0tLS0tLS0tLS0tLTH2uxc7SzruegVFQUE9PT05GSUdHRkZGRkZGz8/MzMzOz87Oz3dERUVFRUXOztDQSSdPa2xsa2tra2ttbW1ta4yx29rb3MGkim5WQSUlJScnR0lJSUlJSkpKSUlJSUlJSUlKvLy8u7y8u75GRkdHR0fs7OwPSqmfUEtJRTg4ODY2LysrKSkoKh4eHh4eHh4eH05OT09PT09PT09PT09PUFBQUFBQUFBQUFBPT0+4tra2Z2dbOTg7R2eIpK2kmIlsVUxHSlhwhJ+xq6OZmZmZjYiVioFsUS0iICo2TmCClaCzsaVrTEpccZGuurazsK+pop9cY1eRfGtfVUc/dZKecWhtomFjX3aBgXFgVUlAUYeY1ipFVWNseIKMkpmiqK2wubu+wMTFxcbGy8vQ0tHR0tR3iGBXbElAqKuOUk9Yk5OvuLm5ubSgcFZLTGpukpRma2dnZ2dnfpeZl4dwalBOZ2egtbOZeGVmcYKdrbWwrZmZZ2dnZ0c5MzMxMTEzNTk8Z5mZmZmZmcnJx8fGxsXDv7NKQUBUZW1tZV1dY3eUoKqrq5+cnai6xMXAtaWdk4p3YDA8TFZhZ3J8hI6fqrW/z9fs1rypnY2AcWFSRz80LSkgPEFGTlBWV1xdYmhscHN3eHyChoqRlZmeoKKlrbC1usHGv7WupaOak4+IiIR+eXhzbmtnYF1bxsZUUU5JQzs4NmBgYGBhwMC/v7/Dw8PExMPDw2NiZWVlZWVlZWVlYWFlV1dWVlRRVFJSUlTFxcXExMPDw8PDxFBQVFRUVldTVFfHx8fGxcS/v7u5tLCtp6Cal5KOhIB7cm5oYFdOPjgqxauxqZoXipOUZ2eTQ0GIlW2up6+VztDWSXKrpVCoTIOkyz5AQUFBQ0NBP0BGS1FdaHF3goePmaCps7u/xMXFxccjIChdZWBcRx8cGh0rRF11jaW80uBzs6ez29zOqY1qPmxmVjNBPmegtLy1u7iajYyUo6uqpJ+XkY2NjYyKiISZZ2dohIRYW4SEVleUq7q6sI1EREtlkZFbXJOrvr68sZeZmJhnZ2dnZ7a4QUNDP8vR0c/Oy8tFR0eZmZmZmZmZmShmg6q4qYqTpbq7uLWzq6igoJ6Xko2BdmNROC01SkMqAOH3/v/73wDh+v//+eoA6Pj+//nqAOj4///46gDk9vxnZ2dnqKqtgHl1gJSdnZV3cHOCjZyjoJyYl5SUmZmZmUNBRUdLVFhicHt+fn5+fn5+fn5+fn2BiJSns7/ExsbFcHBwcHBtbW1sbGxsbW1sbG1ubXzBw3M1HyApamxtbWzPz8/Oz8nBs5R7Zl1FOTw4RFJgc4mgvsXLy1dSUltix3FwcHBwc3V1dXV1dXNxcXFy1tYgIiJ2dnZ2dnZ1cXFxXDooNVowKDBcMCk1Q1BdeI2kvt3q4Ljd5tyx3+jcqH1mX19mZ2eZmYQ8PkZHSldddYKPlJmZmZmZmZmZmZmTjGdnZ3l4eHl5bFVMSklUgKSxsbawmqqzy76Yk7O+tLCtUTowLVKPsMHS1dHOzMfDtauZgWBFPDEzMTE+XICTjoFnZ2dnW09LXU5FVmNzhJOerrqnj4S/uJmZmZmZmZmZmb5RUElMTrXQ3N3cyYZwbHWOo8HV3dvBnZWOj5mgq7G4fX18gMG/e3h4eXl5fHx8gcG8gjAvLi4uLi4xMTAwL31HxMXGxsbFxcXFxURBPz8/QMPDxMTDw0ZDQ0FGRkdHR5q50OPcv62YhHV2j6u1qo5xVUpUcImKe2dSQCMcL0ZleGtcPDEuJygzYGNjZWZmZ567w8XAqaCOj4+SlJWUlIxlZWVHNjAkJTFQX2BgYGBfYp2qsbGwqJmRjoN8dXJubGdnZ2dUTEtQVFhfZWhxfI2vwMbJyb6qZ1pSRUaZmZmZgIePoLvQ29GwdrDQ3NS+nmFBKyMvT5JPLiQvRF9weH+uvsTEuqBYo7nAwL6vd2FQR0dHandqSklJSUlJSldshv8SfP8NaP7/DAz/B/0DA8T/yw/r++4PbfcSEvX4FBpaUWfJe7Cfqatnq2erqZ9KO5N952qZW4d2c3WGxlCZmdJnZ2dnZ2dnZ2dnZ2dnZ2dnmZmZmZmZmZmZmZmZmZmZmWdnZ2dnZ2dnZ2dnZ2dnZ2eZmZmZmZmZmZmZmZmZmZmZZ2dnZ2dnZ2dnZ2dnZ2dnZ5mZmZmZmZmZmZmZmZmZmZmenJR5d4KSlYRmVlBRUVJnr8fHwbSrpaKelHllZWVugWdnZ2dnZ2dnZ2dnZ2dnZ2eZmZmZmZmZmZmZmZmZmZmZZ2dnZ2dnZ2dnZ2dnZ2dnZ5mZmZmZmZmZmZmZmZmZmZlnZ2dnbmBfYmuOvsC5qJKHhIB+fXx8fXFnVVaan5mZmWdnZ2dnZ2dnZ2dnZ2dnZ2eZmZmZmZmZmZmZmZmZmZmZZ2dnZ2dnZ2dnZ2dnZ2dnZ5mZmZmZmZmZmZmZmZmZmZlnZ2dnZ2dnZ2dnZ2dnZ2dnmZmZmZmZmZmZmZmZmZmZmWdnZ2dhWoGRhltYZXyap6mfc3FmYXycqa6kj4J9fYGMZ2dnZ2dnZ2dnZ2dnZ2dnZ5mZmZmZmZmZmZmZmZmZmZlzdTw6Oz8/Pz9FR0pPV2Fqc36JjZqgqrC2vL+/vnd3c5pROjQxKycrKysuMDAxNj44ODtKk7zL0NS/jK/A0Mm4Z2dnZ2dnZ2dnZ2dnZ2dnZ5KtwdDMwamNZmdnZ2dnZ2eKg2dfaGt5eYS4mnBmY2VnZ2dna4+rq6t+bnZ2oKOnmLCwZ0k8Ozs7PEBLUltsj6q0ury6mX1RSpi5uFBKh6u5S05Ma2trampqTE5OTk5OecnJysvLra+urq60yc7OzspwcHJy1NbX2NjY1tR1cnV1c3Nzubm2tkNBQUNxcHJycaurq2dnZ2dmY2NqxsbExV9fX2HGycbGxkVEPkA8Ozs7Ii5L/+sAGi9FYXecvtXh7PX5/v7+/v7++/Dr3LAoDRMjIiUCIy8rPDRHUU9GHhMZIDUKCkQqGhoKCQwREy88PoSMnIynoLuoz7i8l6eCcnxXZjlOGE9BbmGCopfGp7iZQUNFTHagya6TcEVDQUFBW2iBmai5xc/Gua2VfWtWTkc7Ozs8tLS0trS0Ojo4ODk5uLi4tra2tbW2tra4tbW1tT5WaHFzbF1QODlLbp21w8/Rz8/Pz9DR0dHR0c65h1Y+coOgu8TDuZ13YEA0MDM/VG2Hmaq1wMXGxsO1p5SAc206c3NzlaeooIhYQzpAZnZ1dsPBwMDBwcHBwHV3dnM7O09wlMXav5d2XUs1IjtGXHWPorDF2MOtmYFxW0s6LygkZ2doMzMzMTNlZWhnlZWVlZWV0NDS0NDQ0NDPmJmZmWeYXC8tLS0tLispKTxlfJGcnaq1uriulJK4trWYlbq4qGdnZ2dnZ2dnZ2dnZ2dnZ2eZqL7Hyb+xnJSEfTEpQJyaZ2dnZ2evsLS5Tjw8RU5PZ5mZmZmZmWhdXF+ZmZmZmZlnZ2eAl56VaFJFQ0VKZ2dnmZmZmZmZmZmZmZmZmZmZmWJnZ2dnZ2dnZ2dnZ2dnZ2eZtb6+saOVh3x5cVQ/QUxfNEFOXWVrc36Hj5yjpaijeJejtsDFys/V1tfX1tXV1SuaUTpYVlZ5WlxdXDAwMWA+ODg7SpO5xtDOz6TQ0Mq8rspnUVFMS1ZztsbHvq+djU9PUGF2iZior7i+wMHDxsnKP1BmZWA4NCozO1eInrPBxYaGg7+/moJRQDAkIyMkKTNbWldXV2d2dmc4ODg5OnmvxcTExMSxV1hYWFiImZmZilqCipRyj5uHomxkmX19hY2giWeHZmSMg5RnmIGZpYFmDw4LCgoJCAcHBgYFBQQEAwMDAgICAgICAgICAgICAgAPDgsKCQkJCAgIBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwEODg4ODg4ODg0MDAwMDAwMDAwLCwsLCwsLCwoKCgoKAgUICgsNDg8PDw8PDw8ODg0NDAwLCwsKCgoJCQgICAcPDgwLCgkIBwcGBgYGBQUFBQUEBAMDAgICAgEBAQ8PDw8ODg4ODg4ODg4ODg4ODg0NDAwLCgoJCAgGBQQCAQAAAAUHCQoLCwwMDA0NDQ0ODg4ODg0NDQ0NDAwMDAwMDAwBAQECAgIDAwMDBAQFBAQFBQYHBwgJCQoLCwwNDg4ODg8ODAsKCQgHBwYGBgYFBQUFBQQEAwMCAgICAQEBAQAADw4MCwoJCAcHBgYGBgUFBQUFBAQDAwICAgIBAQEBAAAPDgwLCgkIBwcGBgYGBQUFBQUEBAMDAgICAgEBAQEAAA8ODAsKCQgHBwYGBgYFBQUFBQQEAwMCAgICAQEBAQAADw4MCwoJCAcHBgYGBgUFBQUFBAQDAwICAgIBAQEBAAAPDgwLCgkIBwcGBgYGBQUFBQUEBAMDAgICAgEBAQEAAA8ODAsKCQgHBwYGBgYFBQUFBQQEAwMCAgICAQEBAQAADw4MCwoJCAcHBgcGBgYGBQUFBQYHCAgHCAgBAQEBAAA="}),define("SEnvWorker",["SEnv","WorkerServiceW","Tones.wdt","promise"],function(e,n,t,r){function o(n){var r=Promise.resolve();if(!i){var o={sampleRate:n.sampleRate};i=new e(o,{wavOutSpeed:1e4}),r=i.loadWDT(t)}return r.then(function(){i.load(n.mzo)})}var i;n.serv("MezonetJS/load",o),n.serv("MezonetJS/wavOut",function(e){var n=Promise.resolve();return e.mzo&&(n=o(e)),n.then(function(){return i.wavOut({maxSamples:e.maxSamples,rate:e.rate})}).then(function(e){return delete e.PC2Time,e})}),n.serv("test",function(){return console.log("TEST!!"),"OK"}),n.ready()}),require(["SEnvWorker"]);