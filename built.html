<body><h1>Drag mzo</h1></body>
<script src="js/gen/Mezonet.js"></script>
<script>
    var context;
    if (typeof (webkitAudioContext) !== "undefined") {
        context = new webkitAudioContext();
    } else if (typeof (AudioContext) !== "undefined") {
        context = new AudioContext();
    }
    var t=new Mezonet(context);
    function load(f) {
        var reader = new FileReader();
        reader.onload = (function(theFile) {
          return function(e) {
            var a=Array.prototype.slice.call( new Uint8Array(e.target.result) );
            t.toAudioBuffer(a).then(window.playBuffer);
          };
        })(f);
        reader.readAsArrayBuffer(f);
    }
    function handleFileSelect(evt) {
      evt.stopPropagation();
      evt.preventDefault();

      var files = evt.dataTransfer.files;

      for (var i = 0, f; f = files[i]; i++) {
          console.log(f.name,f.type,f.size);
          load(f);
          break;
      }
    }

    function handleDragOver(evt) {
      evt.stopPropagation();
      evt.preventDefault();
      evt.dataTransfer.dropEffect = 'copy';
    }
    window.stopBufSrc=function () {
        if (window.bufSrc) window.bufSrc.stop();
        delete window.bufSrc;
    };
    window.playBuffer=function (data) {
        window.stopBufSrc();
        console.log("AudioData",data);
        var source = context.createBufferSource();
        source.buffer = data.decodedData;
        source.connect(context.destination);
        if (data.loopStart!=null) {
            source.loop=true;
            source.loopStart=data.loopStart;
            source.loopEnd=data.decodedData.duration;
        }
        console.log("AudioData src",source.loopStart, source.loopEnd);
        source.start = source.start || source.noteOn;
        source.start(0);
        window.bufSrc=source;
    };

    var dropZone = document.querySelector('body');
    dropZone.addEventListener('dragover', handleDragOver, false);
    dropZone.addEventListener('drop', handleFileSelect, false);
</script>
